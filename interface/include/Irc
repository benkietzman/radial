// -*- C++ -*-
// Radial
// -------------------------------------
// file       : Irc
// author     : Ben Kietzman
// begin      : 2022-12-27
// copyright  : kietzman.org
// email      : ben@kietzman.org
/***********************************************************************
* This program is free software; you can redistribute it and/or modify *
* it under the terms of the GNU General Public License as published by *
* the Free Software Foundation; either version 2 of the License, or    *
* (at your option) any later version.                                  *
***********************************************************************/
#ifndef _RADIAL_IRC_
#define _RADIAL_IRC_
// {{{ includes
#include "Interface"
// }}}
extern "C++"
{
namespace radial
{
// {{{ Irc
class Irc : public Interface
{
  protected:
  bool m_bEnabled;
  bool (*m_pAnalyzeCallback1)(string, const string, const string, const string, const string, const string, const bool, map<string, bool> &, list<string> &, const string, stringstream &, Json *);
  bool (*m_pAnalyzeCallback2)(string, const string, const string, const string, const string, const string, const bool, map<string, bool> &, const string, Json *, stringstream &);
  map<string, bool> m_channels;
  list<string> m_messages;
  map<string, list<string> > m_sshClients;
  map<string, list<string> > m_terminalClients;
  mutex m_mutex;
  string m_strNick;
  string m_strPort;
  string m_strServer;
  time_t m_CMonitorChannelsModify;
  Json *m_ptMonitor;

  void analyze(const string strNick, const string strTarget, const string strMessage);
  void analyze(string strPrefix, const string strTarget, const string strUserID, const string strIdent, const string strFirstName, const string strLastName, const bool bAdmin, map<string, bool> &auth, stringstream &ssData);
  void analyze(string strPrefix, const string strTarget, const string strUserID, const string strIdent, const string strFirstName, const string strLastName, const bool bAdmin, map<string, bool> &auth, list<string> &actions, Json *ptData);
  void analyzer(string strPrefix, const string strTarget, const string strUserID, const string strIdent, const string strData);
  void chat(const string strTarget, const string strMessage);
  void enable(const string strNick);
  bool enabled();
  void disable();
  bool isLocalAdmin(const string strUserID, string strApplication, const bool bAdmin, map<string, bool> auth);
  void join(const string strChannel);
  void listChannels();
  void lock();
  bool message(string &strMessage);
  Json *monitor();
  void monitorChannels(string strPrefix);
  void part(const string strChannel);
  void push(const string strMessage);
  void quit();
  void ssh(string strPrefix, const string strTarget, const string strUserID, const string strIdent, const string strServer, const string strPort, const string strUser, string strPassword);
  int sshAuthenticateNone(ssh_session session);
  int sshAuthenticatePassword(ssh_session session, const string strPassword);
  int sshAuthenticateKbdint(ssh_session session, const string strPassword);
  void terminal(string strPrefix, const string strTarget, const string strIdent, string strServer, string strPort);
  void unlock();
  string var(const string strName, Json *ptData);

  public:
  Irc(string strPrefix, int argc, char **argv, void (*pCallback)(string, const string, const bool));
  ~Irc();
  void autoMode(string strPrefix, const string strOldMaster, const string strNewMaster);
  void bot(string strPrefix);
  void callback(string strPrefix, const string strPacket, const bool bResponse);
  void setAnalyze(bool (*)(string, const string, const string, const string, const string, const string, const bool, map<string, bool> &, list<string> &, const string, stringstream &, Json *), bool (*)(string, const string, const string, const string, const string, const string, const bool, map<string, bool> &, const string, Json *, stringstream &));
};
// }}}
}
}
#endif

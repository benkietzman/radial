// -*- C++ -*-
// Radial
// -------------------------------------
// file       : Builder
// author     : Ben Kietzman
// begin      : 2025-10-13
// copyright  : Ben Kietzman
// email      : ben@kietzman.org
#ifndef _RADIAL_BUILD_
#define _RADIAL_BUILD_
// {{{ includes
#include "Interface"
// }}}
extern "C++"
{
namespace radial
{
// {{{ Builder
class Builder : public Interface
{
  protected:
  map<string, bool (Builder::*)(radialUser &, string &)> m_functions;
  map<string, bool (Builder::*)(const string, string &, Json *c, list<string> &, string &, const bool)> m_packages;
  mutex m_mutex;
  string m_strPassword;
  string m_strPrivateKey;
  string m_strPublicKey;
  string m_strSudo;
  string m_strUser;
  thread *m_pThreadInotify;
  Json *m_c;

  bool cmdApt(const string ws, string &s, const string p, list<string> &q, string &e, const bool a = false);
  bool cmdCd(const string ws, string &s, const string p, list<string> &q, string &e, const bool r = false);
  bool cmdChgrp(const string ws, string &s, const string p, const string g, list<string> &q, string &e, const bool r = false);
  bool cmdChmod(const string ws, string &s, const string p, const string m, list<string> &q, string &e, const bool r = false);
  bool cmdChown(const string ws, string &s, const string p, const string u, list<string> &q, string &e, const bool r = false);
  bool cmdChsh(const string ws, string &s, const string u, const string i, list<string> &q, string &e, const bool r = false);
  bool cmdDir(const string ws, string &s, const string p, list<string> &q, string &e);
  bool cmdExit(const string ws, string &s, list<string> &q, string &e);
  bool cmdMkdir(const string ws, string &s, const string p, list<string> &q, string &e, const bool r = false);
  bool cmdRm(const string ws, string &s, const string p, list<string> &q, string &e, const bool r = false);
  bool cmdSudo(const string ws, string &s, const string c, list<string> &q, string &e);
  bool config(radialUser &u, string &e);
  bool confPkg(const string p, Json *c, string &e);
  bool connect(const string ws, const string strServer, const string strPort, const string strUser, const string strPassword, const string strPrivateKey, string &s, list<string> &q, string &e);
  void cred(string strPrefix, const bool bSilent = false);
  bool disconnect(const string ws, string &s, string &e);
  void init(radialUser &u, string &strUser, string &strPassword, string &strPrivateKey, string &strSudo);
  bool install(radialUser &u, string &e);
  string last(const string d);
  void load(string strPrefix, const bool bSilent = false);
  bool pkg(const string ws, string p, string &s, list<string> &q, string &e, const bool a);
  bool pkgApt(const string ws, string &s, Json *c, list<string> &q, string &e, const bool a);
  bool pkgCommon(const string ws, string &s, Json *c, list<string> &q, string &e, const bool a);
  bool pkgDir(const string ws, string &s, Json *c, list<string> &q, string &e, const bool a);
  bool send(const string ws, string &s, const string c, list<string> &q, string &e, const size_t r = 0);
  string strip(const string v);
  bool uninstall(radialUser &u, string &e);

  public:
  Builder(string strPrefix, int argc, char **argv, void (*pCallback)(string, const string strPacket, const bool), void (*pCallbackInotify)(string, const string, const string));
  ~Builder();
  void callback(string strPrefix, const string strPacket, const bool bResponse);
  void callbackInotify(string strPrefix, const string strPath, const string strFile);
};
// }}}
}
}
#endif
